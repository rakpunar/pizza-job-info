<html>
    <title>Basic Tracker</title>
    <div id="container" style="width: 300px; position: fixed; font-family: Arial; color: white; user-select: none;">
        <div style="background: rgba(30,30,30,0.9); padding: 8px; border-radius: 5px 5px 0 0; cursor: default; display: flex; justify-content: space-between; align-items: center;">
            <span style="font-size: 12px; color: #999;">DURUM TAKÄ°P</span>
            <button id="lockBtn" style="background: none; border: none; color: white; cursor: pointer; padding: 2px 8px;">ðŸ”’</button>
        </div>

        <div style="background: rgba(30,30,30,0.9); padding: 10px; border-radius: 0 0 5px 5px;">
            <div style="margin-bottom: 15px;">
                <div style="color: #999; font-size: 12px;">OYUNCU BÄ°LGÄ°SÄ°</div>
                <div style="font-size: 16px; margin-top: 3px;" id="playerInfo">-</div>
            </div>

            <div style="margin-bottom: 15px;">
                <div style="color: #999; font-size: 12px;">KONUM</div>
                <div style="font-size: 16px; margin-top: 3px;" id="location">-</div>
            </div>

            <div>
                <div style="color: #999; font-size: 12px;">ENVANTER</div>
                <div style="font-size: 16px; margin-top: 3px;" id="inventory">
                    Expensive Water: <span id="expensiveWater">0</span><br>
                    Fries: <span id="fries">0</span><br>
                    Soda: <span id="soda">0</span><br>
                    Pizza: <span id="pizza">0</span><br>
                    Chicken Nuggets: <span id="chickenNuggets">0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const container = document.getElementById('container');
        const lockBtn = document.getElementById('lockBtn');
        let isDragging = false;
        let isLocked = true;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        
        // Konum yÃ¼kleme
        const savedPos = localStorage.getItem('trackerPosition');
        if (savedPos) {
            const pos = JSON.parse(savedPos);
            container.style.left = pos.x;
            container.style.top = pos.y;
        } else {
            container.style.right = '20px';
            container.style.top = '20px';
        }

        // TaÅŸÄ±ma iÅŸlemleri
        container.addEventListener('mousedown', (e) => {
            if (isLocked || e.target === lockBtn) return;
            isDragging = true;
            initialX = e.clientX - container.offsetLeft;
            initialY = e.clientY - container.offsetTop;
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            currentX = e.clientX - initialX;
            currentY = e.clientY - initialY;
            
            // Ekran sÄ±nÄ±rlarÄ± kontrolÃ¼
            currentX = Math.max(0, Math.min(currentX, window.innerWidth - container.offsetWidth));
            currentY = Math.max(0, Math.min(currentY, window.innerHeight - container.offsetHeight));
            
            container.style.left = currentX + 'px';
            container.style.top = currentY + 'px';
            container.style.right = 'auto';
        });

        document.addEventListener('mouseup', () => {
            if (!isDragging) return;
            isDragging = false;
            // Konumu kaydet
            localStorage.setItem('trackerPosition', JSON.stringify({
                x: container.style.left,
                y: container.style.top
            }));
        });

        // Kilit butonu
        lockBtn.addEventListener('click', () => {
            isLocked = !isLocked;
            lockBtn.textContent = isLocked ? 'ðŸ”’' : 'ðŸ”“';
            container.style.cursor = isLocked ? 'default' : 'move';
        });

        const itemMapping = {
            'Expensive Water': 'expensiveWater',
            'Fries': 'fries',
            'Soda': 'soda',
            'Pizza': 'pizza',
            'Chicken Nuggets': 'chickenNuggets'
        };

        window.addEventListener("message", (event) => {
            const evt = event.data;
            if (!evt.data) return;
            
            if (evt.data.name || evt.data.user_id) {
                document.getElementById('playerInfo').textContent = 
                    `${evt.data.name || '-'} [ID: ${evt.data.user_id || '-'}]`;
            }

            if (evt.data.zoneName || evt.data.street) {
                document.getElementById('location').textContent = 
                    `${evt.data.zoneName || ''} ${evt.data.street ? `- ${evt.data.street}` : ''}`;
            }

            if (evt.data.inventory) {
                try {
                    const inv = JSON.parse(evt.data.inventory);
                    Object.values(itemMapping).forEach(id => {
                        document.getElementById(id).textContent = '0';
                    });
                    Object.entries(inv).forEach(([item, count]) => {
                        const itemId = itemMapping[item];
                        if (itemId) {
                            document.getElementById(itemId).textContent = count;
                        }
                    });
                } catch (e) {
                    console.error('Envanter parse hatasÄ±:', e);
                }
            }
        });

        window.parent.postMessage({type: "getData"}, "*");

        window.addEventListener('keydown', (e) => {
            if (e.key === "Escape") {
                window.parent.postMessage({type: "pin"}, "*");
            }
        });
    </script>
</html>
